<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>English Pronunciation</title>

<style>
  body {
    font-family: Arial, sans-serif;
    padding: 40px;
    background-color: #f5f5f5;
  }
  h1 { text-align: center; }
  #login { text-align: center; margin-bottom: 20px; }

  #wordList {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 15px;
  }

  .word-btn {
    border: 2px solid black;
    padding: 10px;
    background: white;
    cursor: pointer;
  }

  .word-btn.active {
    border-color: red;
  }
</style>
</head>

<body>

<h1>Click a word to hear pronunciation</h1>

<div id="login">
  <button id="loginBtn">Login with Google</button>
</div>

<div id="wordList"></div>

<!-- ===================== -->
<!-- FIREBASE (MODULE) -->
<!-- ===================== -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getAuth,
    signInWithPopup,
    GoogleAuthProvider,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import {
    getFirestore,
    doc,
    setDoc,
    getDoc
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD36XPvB_ICTiDnFlasbv7GdATG950zPsA",
  authDomain: "english-pronunciation-3dba5.firebaseapp.com",
  projectId: "english-pronunciation-3dba5",
  storageBucket: "english-pronunciation-3dba5.firebasestorage.app",
  messagingSenderId: "956820967960",
  appId: "1:956820967960:web:c7fcc6c3dc4de70a9ca96d"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // ðŸ”¥ EXPONER SOLO FUNCIONES
  window.firebaseAPI = {
    login: async () => {
      const provider = new GoogleAuthProvider();
      await signInWithPopup(auth, provider);
    },

    onUserChange: (callback) => {
      onAuthStateChanged(auth, callback);
    },

    getLastWord: async (uid) => {
      const snap = await getDoc(doc(db, "progress", uid));
      return snap.exists() ? snap.data().lastWord : null;
    },

    saveWord: async (uid, word) => {
      await setDoc(
        doc(db, "progress", uid),
        { lastWord: word },
        { merge: true }
      );
    }
  };
</script>

<!-- ===================== -->
<!-- SCRIPT NORMAL (UI) -->
<!-- ===================== -->
<script>
  const words = [
    "apple","book","computer","language","development",
    "music","internet","design","script","browser"
  ];

  const container = document.getElementById("wordList");
  const loginBtn = document.getElementById("loginBtn");

  let activeBtn = null;
  let currentUser = null;

  loginBtn.onclick = () => window.firebaseAPI.login();

  window.firebaseAPI.onUserChange(async user => {
    if (!user) return;

    currentUser = user;
    loginBtn.style.display = "none";

    const saved = await window.firebaseAPI.getLastWord(user.uid);
    render(saved);
  });

  function render(savedWord) {
    container.innerHTML = "";

    words.forEach(word => {
      const btn = document.createElement("button");
      btn.textContent = word;
      btn.className = "word-btn";

      if (word === savedWord) {
        btn.classList.add("active");
        activeBtn = btn;
        btn.scrollIntoView({ block: "center" });
      }

      btn.onclick = () => {
        if (activeBtn) activeBtn.classList.remove("active");
        btn.classList.add("active");
        activeBtn = btn;

        window.firebaseAPI.saveWord(currentUser.uid, word);
      };

      container.appendChild(btn);
    });
  }
</script>

</body>
</html>
