<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>English Pronunciation</title>

<style>
  body {
    font-family: Arial, sans-serif;
    padding: 40px;
    background-color: #f5f5f5;
  }

  h1 {
    text-align: center;
    margin-bottom: 20px;
  }

  #login {
    text-align: center;
    margin-bottom: 30px;
  }

  #wordList {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 15px;
  }

  .word-btn {
    font-size: 16px;
    background-color: white;
    border: 2px solid black;
    border-radius: 5px;
    cursor: pointer;
    padding: 10px 15px;
    text-align: center;
  }

  .word-btn.active {
    border: 2px solid red;
  }
</style>
</head>

<body>

<h1>Click a word to hear pronunciation</h1>

<div id="login">
  <button id="loginBtn">Login with Google</button>
</div>

<div id="wordList"></div>

<!-- ===================== -->
<!-- FIREBASE MODULE (PRIMERO) -->
<!-- ===================== -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getAuth,
    signInWithPopup,
    GoogleAuthProvider,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import {
    getFirestore,
    doc,
    setDoc,
    getDoc
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "TU_API_KEY",
    authDomain: "TU_AUTH_DOMAIN",
    projectId: "TU_PROJECT_ID",
    storageBucket: "TU_STORAGE_BUCKET",
    messagingSenderId: "TU_SENDER_ID",
    appId: "TU_APP_ID"
  };

  const app = initializeApp(firebaseConfig);

  // üî• AQU√ç se crean (NO desde window)
  const auth = getAuth(app);
  const db = getFirestore(app);

  // üî• Exponer a window
  window.firebaseApp = {
    auth,
    db,
    signInWithPopup,
    GoogleAuthProvider,
    onAuthStateChanged,
    doc,
    setDoc,
    getDoc
  };
</script>

<!-- ===================== -->
<!-- SCRIPT NORMAL (DESPU√âS) -->
<!-- ===================== -->
<script>
  const {
    auth,
    db,
    signInWithPopup,
    GoogleAuthProvider,
    onAuthStateChanged,
    doc,
    setDoc,
    getDoc
  } = window.firebaseApp;

  const words = [
    "apple", "book", "computer", "language", "development",
    "music", "internet", "design", "script", "browser",
    "window", "document", "function", "variable", "button",
    "audio", "server", "github", "mobile", "tablet"
  ];

  const container = document.getElementById("wordList");
  const loginBtn = document.getElementById("loginBtn");

  let activeButton = null;
  let currentUser = null;

  // ---------- LOGIN ----------
  loginBtn.onclick = async () => {
    const provider = new GoogleAuthProvider();
    await signInWithPopup(auth, provider);
  };

  // ---------- AUTH STATE ----------
  onAuthStateChanged(auth, async user => {
    if (!user) return;

    currentUser = user;
    loginBtn.style.display = "none";

    const ref = doc(db, "progress", user.uid);
    const snap = await getDoc(ref);
    const savedWord = snap.exists() ? snap.data().lastWord : null;

    renderWords(savedWord);
  });

  async function guardarUltimaPalabra(word) {
    if (!currentUser) return;

    await setDoc(
      doc(db, "progress", currentUser.uid),
      { lastWord: word },
      { merge: true }
    );
  }

  function renderWords(savedWord) {
    container.innerHTML = "";

    words.forEach(word => {
      const btn = document.createElement("button");
      btn.className = "word-btn";
      btn.textContent = word;

      if (word === savedWord) {
        btn.classList.add("active");
        activeButton = btn;

        setTimeout(() => {
          btn.scrollIntoView({ behavior: "smooth", block: "center" });
        }, 100);
      }

      btn.onclick = () => {
        if (activeButton) activeButton.classList.remove("active");

        btn.classList.add("active");
        activeButton = btn;

        guardarUltimaPalabra(word);
      };

      container.appendChild(btn);
    });
  }
</script>

</body>
</html>
